
bandNames_39 <- c(
  #"Abs_Lat",
  "CGIAR_Aridity_Index",
  "CGIAR_PET",
  "CHELSA_BIO_Annual_Mean_Temperature",
  "CHELSA_BIO_Annual_Precipitation",
  #"CHELSA_BIO_Isothermality",
  #"CHELSA_BIO_Max_Temperature_of_Warmest_Month",
  #"CHELSA_BIO_Mean_Diurnal_Range",
  #"CHELSA_BIO_Mean_Temperature_of_Coldest_Quarter",
  #"CHELSA_BIO_Mean_Temperature_of_Driest_Quarter",
  #"CHELSA_BIO_Mean_Temperature_of_Warmest_Quarter",
  #"CHELSA_BIO_Mean_Temperature_of_Wettest_Quarter",
  #"CHELSA_BIO_Min_Temperature_of_Coldest_Month",
  "CHELSA_BIO_Precipitation_Seasonality",
  #"CHELSA_BIO_Precipitation_of_Coldest_Quarter",
  #"CHELSA_BIO_Precipitation_of_Driest_Month",
  #"CHELSA_BIO_Precipitation_of_Driest_Quarter",
  #"CHELSA_BIO_Precipitation_of_Warmest_Quarter",
  #"CHELSA_BIO_Precipitation_of_Wettest_Month",
  #"CHELSA_BIO_Precipitation_of_Wettest_Quarter",
  #"CHELSA_BIO_Temperature_Annual_Range",
  #"CHELSA_BIO_Temperature_Seasonality",
  #"CIFOR_TropicalPeatlandDepth",
  "CIFOR_TropicalPeatlandExtent",
  #"CMS_HeterotrophicRespiration_usingEquationFromBondLamberty2004",
  #"CMS_HeterotrophicRespiration_usingEquationFromSubke2006",
  #"CMS_SoilRespiration_mean",
  #"CSP_Global_Human_Modification",
  "ConsensusLandCoverClass_Barren",
  "ConsensusLandCoverClass_Cultivated_and_Managed_Vegetation",
  "ConsensusLandCoverClass_Deciduous_Broadleaf_Trees",
  "ConsensusLandCoverClass_Evergreen_Broadleaf_Trees",
  "ConsensusLandCoverClass_Evergreen_Deciduous_Needleleaf_Trees",
  "ConsensusLandCoverClass_Herbaceous_Vegetation",
  #"ConsensusLandCoverClass_Mixed_Other_Trees",
  "ConsensusLandCoverClass_Open_Water",
  "ConsensusLandCoverClass_Regularly_Flooded_Vegetation",
  "ConsensusLandCoverClass_Shrubs",
  "ConsensusLandCoverClass_Snow_Ice",
  "ConsensusLandCoverClass_Urban_Builtup",
  #"ConsensusLandCover_Human_Development_Percentage",
  "CrowtherLab_Tree_Density",
  "EarthEnvCloudCover_CloudForestPrediction",
  #"EarthEnvCloudCover_Mean",
  #"EarthEnvTexture_CoOfVar_EVI",
  #"EarthEnvTexture_Contrast_EVI",
  "EarthEnvTexture_Correlation_EVI",
  #"EarthEnvTexture_Dissimilarity_EVI",
  #"EarthEnvTexture_Entropy_EVI",
  "EarthEnvTexture_Evenness_EVI",
  #"EarthEnvTexture_Homogeneity_EVI",
  #"EarthEnvTexture_Maximum_EVI",
  "EarthEnvTexture_Range_EVI",
  #"EarthEnvTexture_Shannon_Index",
  #"EarthEnvTexture_Simpson_Index",
  #"EarthEnvTexture_Std_EVI",
  #"EarthEnvTexture_Uniformity_EVI",
  #"EarthEnvTexture_Variance_EVI",
  "EarthEnvTopoMed_1stOrderPartialDerivEW",
  "EarthEnvTopoMed_1stOrderPartialDerivNS",
  #"EarthEnvTopoMed_2ndOrderPartialDerivEW",
  #"EarthEnvTopoMed_2ndOrderPartialDerivNS",
  #"EarthEnvTopoMed_AspectCosine",
  #"EarthEnvTopoMed_AspectSine",
  "EarthEnvTopoMed_Eastness",
  "EarthEnvTopoMed_Elevation",
  "EarthEnvTopoMed_Northness",
  #"EarthEnvTopoMed_ProfileCurvature",
  #"EarthEnvTopoMed_Roughness",
  #"EarthEnvTopoMed_Slope",
  #"EarthEnvTopoMed_TangentialCurvature",
  #"EarthEnvTopoMed_TerrainRuggednessIndex",
  "EarthEnvTopoMed_TopoPositionIndex",
  #"EarthEnvTopoMed_VectorRuggednessMeasure",
  "EsaCci_BurntAreasProbability",
  "FanEtAl_Depth_to_Water_Table_AnnualMean",
  "FanEtAl_Depth_to_Water_Table_AnnualSD",
  #"GHS_Population_Density",
  "GLW3_RuminantsDistribution_downsampled10km",
  "GPWv4_Population_Density",
  #"GiriEtAl_MangrovesExtent",
  #"GoshEtAl_GlobalGDP2006",
  #"IPCC_Global_Biomass",
  #"MODIS_EVI",
  #"MODIS_FPAR",
  #"MODIS_GPP",
  #"MODIS_LAI",
  #"MODIS_NDVI",
  "MODIS_NPP",
  #"MODIS_Nadir_Reflectance_Band1",
  #"MODIS_Nadir_Reflectance_Band2",
  #"MODIS_Nadir_Reflectance_Band3",
  #"MODIS_Nadir_Reflectance_Band4",
  #"MODIS_Nadir_Reflectance_Band5",
  #"MODIS_Nadir_Reflectance_Band6",
  #"MODIS_Nadir_Reflectance_Band7",
  #"NASA_ForestCanopyHeight",
  "PelletierEtAl_SoilAndSedimentaryDepositThicknesses",
  #"Resolve_Biome",
  #"Resolve_Ecoregion",
  #"SG_Absolute_depth_to_bedrock",
  "SG_Bulk_density_015cm",
  #"SG_CEC_015cm",
  #"SG_Clay_Content_015cm",
  #"SG_Coarse_fragments_015cm",
  "SG_Depth_to_bedrock",
  "SG_H2O_Capacity_015cm",
  #"SG_SOC_Content_015cm",
  #"SG_SOC_Density_015cm",
  #"SG_SOC_Stock_005cm_to_015cm",
  #"SG_Saturated_H2O_Content_015cm",
  #"SG_Silt_Content_015cm",
  #"SG_Soil_H2O_Capacity_pF_20_015cm",
  #"SG_Soil_pH_H2O_015cm",
  #"SpawnEtAl_HarmonizedAGBiomass",
  #"SpawnEtAl_HarmonizedBGBiomass",
  "TootchiEtAl_WetlandsRegularlyFlooded"
  #"UNEP_WCMC_Biomass",
  #"WCS_Human_Footprint_2009",
  #"WWF_Biome",
  #"WWF_Ecoregion"
)

bandNames_Human <-c(
  "ConsensusLandCoverClass_Cultivated_and_Managed_Vegetation",
  "ConsensusLandCoverClass_Urban_Builtup",
  "GPWv4_Population_Density",
  "GLW3_RuminantsDistribution_downsampled10km",
  "EsaCci_BurntAreasProbability")
  
bandNames_Environmental <- c(
    #"Abs_Lat",
    "CGIAR_Aridity_Index",
    "CGIAR_PET",
    "CHELSA_BIO_Annual_Mean_Temperature",
    "CHELSA_BIO_Annual_Precipitation",
    "CHELSA_BIO_Precipitation_Seasonality",
    "CIFOR_TropicalPeatlandExtent",
    "ConsensusLandCoverClass_Barren",
    "ConsensusLandCoverClass_Deciduous_Broadleaf_Trees",
    "ConsensusLandCoverClass_Evergreen_Broadleaf_Trees",
    "ConsensusLandCoverClass_Evergreen_Deciduous_Needleleaf_Trees",
    "ConsensusLandCoverClass_Herbaceous_Vegetation",
    "ConsensusLandCoverClass_Open_Water",
    "ConsensusLandCoverClass_Regularly_Flooded_Vegetation",
    "ConsensusLandCoverClass_Shrubs",
    "ConsensusLandCoverClass_Snow_Ice",
    "CrowtherLab_Tree_Density",
    "EarthEnvCloudCover_CloudForestPrediction",
    "EarthEnvTexture_Correlation_EVI",
    "EarthEnvTexture_Evenness_EVI",
    "EarthEnvTexture_Range_EVI",
    "EarthEnvTopoMed_1stOrderPartialDerivEW",
    "EarthEnvTopoMed_1stOrderPartialDerivNS",
    "EarthEnvTopoMed_Eastness",
    "EarthEnvTopoMed_Elevation",
    "EarthEnvTopoMed_Northness",
    "EarthEnvTopoMed_TopoPositionIndex",
    "FanEtAl_Depth_to_Water_Table_AnnualMean",
    "FanEtAl_Depth_to_Water_Table_AnnualSD",
    "MODIS_NPP",
    "PelletierEtAl_SoilAndSedimentaryDepositThicknesses",
    "SG_Bulk_density_015cm",
    "SG_Depth_to_bedrock",
    "SG_H2O_Capacity_015cm",
    "TootchiEtAl_WetlandsRegularlyFlooded"
  )


joiningWithFeatureSets <- function(SMDW_training, earth_observation_features, bandNames){
  joint_SMDW_Features <- SMDW_training %>% 
    left_join(earth_observation_features, by = c("HH7_region"="HH7_region"))%>%
    select(all_of("HH7_region"),all_of("NAME_0"), all_of(bandNames), all_of("SMDWcoverageAtRegionalLevel"),all_of("HouseholdsInRegion.Freq.x")) 
  return(joint_SMDW_Features)
}

renameFeatures <- function(df,oldVariableName, newVariableName){
  names(df)[names(df) == oldVariableName] <- newVariableName 
  return(df)
}

renameFeatures <- function(df){
  df <- renameVariable(df,'CGIAR_Aridity_Index','Aridity Index')
  df <- renameVariable(df,'CHELSA_BIO_Precipitation_Seasonality','Precipitation Seasonality')
  df <- renameVariable(df,'ConsensusLandCoverClass_Urban_Builtup','Urban Builtup Land Cover')
  df <- renameVariable(df,'EarthEnvCloudCover_CloudForestPrediction','Cloud Forest Prediction')
  df <- renameVariable(df,'EsaCci_BurntAreasProbability','Burnt Areas Probability')
  df <- renameVariable(df,'CrowtherLab_Tree_Density','Tree Density')
  df <- renameVariable(df,'SG_Absolute_depth_to_bedrock','Absolute Depth To Bedrock')
  df <- renameVariable(df,'GPWv4_Population_Density','Population Density')
  df <- renameVariable(df,'SG_Absolute_depth_to_bedrock','Absolute Depth To Bedrock')
  df <- renameVariable(df,'CHELSA_BIO_Annual_Mean_Temperature','Annual Mean Temperature')
  df <- renameVariable(df,'ConsensusLandCoverClass_Barren','Barren Land Cover')
  df <- renameVariable(df,'SG_H2O_Capacity_015cm','H2O Capacity 15cm Below Ground Surface')
  df <- renameVariable(df,'EarthEnvTexture_Range_EVI','Enhanced Vegetation Index Range')
  df <- renameVariable(df,'EarthEnvTexture_Evenness_EVI','Enhanced Vegetation Index Evenness')
  df <- renameVariable(df,'ConsensusLandCoverClass_Cultivated_and_Managed_Vegetation','Cultivated and Managed Vegetation')
  df <- renameVariable(df,'ConsensusLandCoverClass_Barren','H2O Capacity 15cm Below Ground Surface')
  df <- renameVariable(df,'GLW3_RuminantsDistribution_downsampled10km','Ruminants Distribution')
  df <- renameVariable(df,'MODIS_NPP','Net Primary Production')
  df <- renameVariable(df,'CGIAR_PET','Potential Evapo-transpiration')
  df <- renameVariable(df,'SG_Bulk_density_015cm','Bulk Density 15cm Below Ground Surface')
  df <- renameVariable(df,'CHELSA_BIO_Annual_Precipitation','Annual Precipitation')
  df <- renameVariable(df,'ConsensusLandCoverClass_Shrubs','Shrub Land Cover')
  df <- renameVariable(df,'ConsensusLandCoverClass_Herbaceous_Vegetation','Herbaceous Vegetation')
  df <- renameVariable(df,'FanEtAl_Depth_to_Water_Table_AnnualMean','Depth to Water Table')
  df <- renameVariable(df,'ConsensusLandCoverClass_Deciduous_Broadleaf_Trees','Deciduous Broadleaf Tree Cover')
  return(df)
}



rename39Features <- function(df){
  
  df$feature[df$feature == "CGIAR_Aridity_Index" ] <- "Aridity Index"
  df$feature[df$feature == "CHELSA_BIO_Precipitation_Seasonality"] <- "Precipitation Seasonality" 
  df$feature[df$feature == "ConsensusLandCoverClass_Urban_Builtup" ] <- "Urban Builtup Land Cover"
  df$feature[df$feature == "EarthEnvCloudCover_CloudForestPrediction " ] <- "Cloud Forest Prediction"
  df$feature[df$feature == "EarthEnvCloudCover_CloudForestPrediction" ] <- "Cloud Forest Prediction"
  df$feature[df$feature == "EsaCci_BurntAreasProbability" ] <- "Burnt Areas Probability"
  df$feature[df$feature == "CrowtherLab_Tree_Density" ] <- "Tree Density"
  df$feature[df$feature == "SG_Absolute_depth_to_bedrock " ] <- "Absolute Depth To Bedrock"
  df$feature[df$feature == "SG_Absolute_depth_to_bedrock" ] <- "Absolute Depth To Bedrock"
  df$feature[df$feature == "GPWv4_Population_Density" ] <- "Population Density"
  df$feature[df$feature == "CHELSA_BIO_Annual_Mean_Temperature " ] <- "Annual Mean Temperature"
  df$feature[df$feature == "CHELSA_BIO_Annual_Mean_Temperature" ] <- "Annual Mean Temperature"
  df$feature[df$feature == "ConsensusLandCoverClass_Barren"] <- "Barren Land Cover"
  df$feature[df$feature == "SG_H2O_Capacity_015cm" ] <- "H2O Capacity 15cm Below Ground Surface"
  df$feature[df$feature == "EarthEnvTexture_Range_EVI" ] <- "Enhanced Vegetation Index Range"
  df$feature[df$feature == "EarthEnvTexture_Evenness_EVI" ] <- "Enhanced Vegetation Index Evenness"
  df$feature[df$feature == "ConsensusLandCoverClass_Cultivated_and_Managed_Vegetation" ] <- "Cultivated and Managed Vegetation"
  df$feature[df$feature == "GLW3_RuminantsDistribution_downsampled10km" ] <- "Ruminants Distribution"
  df$feature[df$feature == "MODIS_NPP" ] <- "Net Primary Production"
  df$feature[df$feature == "CGIAR_PET " ] <- "Potential Evapo-transpiration"
  df$feature[df$feature == "CGIAR_PET" ] <- "Potential Evapo-transpiration"
  df$feature[df$feature == "SG_Bulk_density_015cm " ] <- "Bulk Density 15cm Below Ground Surface"
  df$feature[df$feature == "SG_Bulk_density_015cm" ] <- "Bulk Density 15cm Below Ground Surface"
  df$feature[df$feature == "CHELSA_BIO_Annual_Precipitation " ] <- "Annual Precipitation"
  df$feature[df$feature == "CHELSA_BIO_Annual_Precipitation" ] <- "Annual Precipitation"
  df$feature[df$feature == "CHELSA_BIO_Precipitation_Seasonality" ] <- "Precipitation Seasonality"
  df$feature[df$feature == "ConsensusLandCoverClass_Shrubs " ] <- "Shrub Land Cover"
  df$feature[df$feature == "ConsensusLandCoverClass_Shrubs" ] <- "Shrub Land Cover"
  df$feature[df$feature == "ConsensusLandCoverClass_Herbaceous_Vegetation" ] <- "Herbaceous Vegetation"
  df$feature[df$feature == "FanEtAl_Depth_to_Water_Table_AnnualMean" ] <- "Depth to Water Table"
  df$feature[df$feature == "ConsensusLandCoverClass_Deciduous_Broadleaf_Trees" ] <- "Deciduous Broadleaf Tree Cover"
  
  return(df)
}

rename41Features <- function(df){
  
  df$feature[df$feature == "Government_Effectiveness" ] <- "Government Effectiveness"
  df$feature[df$feature == "Regulatory_Quality" ] <- "Regulatory Quality"
  
  df$feature[df$feature == "CGIAR_Aridity_Index" ] <- "Aridity Index"
  df$feature[df$feature == "CHELSA_BIO_Precipitation_Seasonality"] <- "Precipitation Seasonality" 
  df$feature[df$feature == "ConsensusLandCoverClass_Urban_Builtup" ] <- "Urban Builtup Land Cover"
  df$feature[df$feature == "EarthEnvCloudCover_CloudForestPrediction " ] <- "Cloud Forest Prediction"
  df$feature[df$feature == "EarthEnvCloudCover_CloudForestPrediction" ] <- "Cloud Forest Prediction"
  df$feature[df$feature == "EsaCci_BurntAreasProbability" ] <- "Burnt Areas Probability"
  df$feature[df$feature == "CrowtherLab_Tree_Density" ] <- "Tree Density"
  df$feature[df$feature == "SG_Absolute_depth_to_bedrock " ] <- "Absolute Depth To Bedrock"
  df$feature[df$feature == "SG_Absolute_depth_to_bedrock" ] <- "Absolute Depth To Bedrock"
  df$feature[df$feature == "GPWv4_Population_Density" ] <- "Population Density"
  df$feature[df$feature == "CHELSA_BIO_Annual_Mean_Temperature " ] <- "Annual Mean Temperature"
  df$feature[df$feature == "CHELSA_BIO_Annual_Mean_Temperature" ] <- "Annual Mean Temperature"
  df$feature[df$feature == "ConsensusLandCoverClass_Barren"] <- "Barren Land Cover"
  df$feature[df$feature == "SG_H2O_Capacity_015cm" ] <- "H2O Capacity 15cm Below Ground Surface"
  df$feature[df$feature == "EarthEnvTexture_Range_EVI" ] <- "Enhanced Vegetation Index Range"
  df$feature[df$feature == "EarthEnvTexture_Evenness_EVI" ] <- "Enhanced Vegetation Index Evenness"
  df$feature[df$feature == "ConsensusLandCoverClass_Cultivated_and_Managed_Vegetation" ] <- "Cultivated and Managed Vegetation"
  df$feature[df$feature == "GLW3_RuminantsDistribution_downsampled10km" ] <- "Ruminants Distribution"
  df$feature[df$feature == "MODIS_NPP" ] <- "Net Primary Production"
  df$feature[df$feature == "CGIAR_PET " ] <- "Potential Evapo-transpiration"
  df$feature[df$feature == "CGIAR_PET" ] <- "Potential Evapo-transpiration"
  df$feature[df$feature == "SG_Bulk_density_015cm " ] <- "Bulk Density 15cm Below Ground Surface"
  df$feature[df$feature == "SG_Bulk_density_015cm" ] <- "Bulk Density 15cm Below Ground Surface"
  df$feature[df$feature == "CHELSA_BIO_Annual_Precipitation " ] <- "Annual Precipitation"
  df$feature[df$feature == "CHELSA_BIO_Annual_Precipitation" ] <- "Annual Precipitation"
  df$feature[df$feature == "CHELSA_BIO_Precipitation_Seasonality" ] <- "Precipitation Seasonality"
  df$feature[df$feature == "ConsensusLandCoverClass_Shrubs " ] <- "Shrub Land Cover"
  df$feature[df$feature == "ConsensusLandCoverClass_Shrubs" ] <- "Shrub Land Cover"
  df$feature[df$feature == "ConsensusLandCoverClass_Herbaceous_Vegetation" ] <- "Herbaceous Vegetation"
  df$feature[df$feature == "FanEtAl_Depth_to_Water_Table_AnnualMean" ] <- "Depth to Water Table"
  df$feature[df$feature == "ConsensusLandCoverClass_Deciduous_Broadleaf_Trees" ] <- "Deciduous Broadleaf Tree Cover"
  
  return(df)
}


group39FeaturesInto5IndicatorGroups <- function(df){
  library(plyr)
  df$Indicator.Group <- revalue(df$feature,
                             c("Aridity Index"="Climate (n=7)", "Potential Evapo-transpiration"="Climate (n=7)", "Annual Mean Temperature"="Climate (n=7)", "Annual Precipitation"="Climate (n=7)", "Precipitation Seasonality"="Climate (n=7)","CIFOR_TropicalPeatlandExtent"="Biogeography (n=14)", "Barren Land Cover"="Biogeography (n=14)", "Cultivated and Managed Vegetation"="Human (n=5)", "Deciduous Broadleaf Tree Cover"="Biogeography (n=14)", 
                               "ConsensusLandCoverClass_Evergreen_Broadleaf_Trees"="Biogeography (n=14)","ConsensusLandCoverClass_Evergreen_Deciduous_Needleleaf_Trees"="Biogeography (n=14)", "Herbaceous Vegetation"="Biogeography (n=14)", "ConsensusLandCoverClass_Open_Water"="Hydrogeology (n=7)", "ConsensusLandCoverClass_Regularly_Flooded_Vegetation"="Biogeography (n=14)", 
                               "Shrub Land Cover"="Biogeography (n=14)",  "ConsensusLandCoverClass_Snow_Ice"="Climate (n=7)","Urban Builtup Land Cover"="Human (n=5)","Tree Density"="Biogeography (n=14)", "Cloud Forest Prediction"="Climate (n=7)", 
                               "EarthEnvTexture_Correlation_EVI"="Biogeography (n=14)", "Enhanced Vegetation Index Evenness"="Biogeography (n=14)", "Enhanced Vegetation Index Range"="Biogeography (n=14)", "EarthEnvTopoMed_1stOrderPartialDerivEW"= "Topography (n=6)", 
                               "EarthEnvTopoMed_1stOrderPartialDerivNS"="Topography (n=6)","EarthEnvTopoMed_Eastness"="Topography (n=6)","EarthEnvTopoMed_Elevation"="Topography (n=6)","EarthEnvTopoMed_Northness"="Topography (n=6)","EarthEnvTopoMed_TopoPositionIndex"="Topography (n=6)",
                               "Burnt Areas Probability"="Human (n=5)","Depth to Water Table"="Hydrogeology (n=7)","FanEtAl_Depth_to_Water_Table_AnnualSD"="Hydrogeology (n=7)","Ruminants Distribution"="Human (n=5)","Population Density"="Human (n=5)","Net Primary Production"="Biogeography (n=14)","PelletierEtAl_SoilAndSedimentaryDepositThicknesses"="Hydrogeology (n=7)",
                               "Bulk Density 15cm Below Ground Surface"="Hydrogeology (n=7)", "SG_Depth_to_bedrock"="Hydrogeology (n=7)", "H2O Capacity 15cm Below Ground Surface"="Hydrogeology (n=7)", "TootchiEtAl_WetlandsRegularlyFlooded"="Biogeography (n=14)" ))
  df$Indicator.Group <- as.factor(df$Indicator.Group)
  detach("package:plyr", unload = TRUE)
  return(df)
}
